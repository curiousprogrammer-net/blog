
    <html>
      <head>
        <title>My</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
      </head>
      <body>
        <div id='content'>
    <h1 id="weekly-bits--pieces-012020-274---35">Weekly Bits &amp; Pieces 01/2020 (27.4. - 3.5.)</h1>
<p><em>This is the very first weekly summary published on my blog. 
It reviews interesting stuff I did and found in the past week</em>.</p>
  <!-- markdown-toc start
       THIS HAS BEEN MANUALLY GENERATED!
       It doesn't work in Wordpress if you just use markdown style table of contents
       -->
<p><strong>Table of Contents</strong></p>
<ul>
    <li><a href="#clojure">Clojure</a></li>
    <li><a href="#learning">Learning</a>
      <ul>
        <li><a href="#rapid-learner">Rapid Learner</a></li>
      </ul></li>
    <li><a href="#reading">Reading</a></li>
    <li><a href="#writing">Writing</a></li>
    <li><a href="#personal-hobbies">Personal (Hobbies)</a></li>
    <li><a href="#projects-update">Projects Update</a>
      <ul>
        <li><a href="#python-for-data-science">Python for Data Science</a></li>
        <li><a href="#sicp">SICP</a></li>
        <li><a href="#computer-systems">Computer Systems</a></li>
      </ul></li>
    <li><a href="#work-codescene">Work (CodeScene)</a>
      <ul>
        <li><a href="#codescene-40">CodeScene 4.0</a></li>
        <li><a href="#jvm-crash-and-slow-analyses">JVM crash and slow analyses</a>
          <ul>
            <li><a href="#windows-server---linux-vm-and-jvm-bug">Windows Server - Linux VM and JVM bug</a></li>
            <li><a href="#windows-server---tomcat-and-small-heap-size">Windows Server - Tomcat and small heap size</a></li>
            <li><a href="#azure-containers---really-slow-io">Azure Containers - (really) slow IO</a></li>
          </ul></li>
      </ul></li>
  </ul>
<!-- markdown-toc end -->
<div id="clojure"></div>
<h2 id="clojure">Clojure</h2>
<p>I found two interesting pieces on Clojurians slack:</p>
<ul>
<li>hiredman's <code>for</code> example ("swiss army knife") showing how to navigate nested data (even using a recursive function)</li>
</ul>
<pre><code>(for [maybe-x (tree-seq map? :content xml)
      :when (= (:tag maybe-x) :x)
      maybe-y (:content maybe-x)
      :when (= (:tag maybe-y) :y)
      ,,,
      ]
  whatever)

;; you can even do recursive queries with it by just wrapping it in a recursive function 
(fn f [whatever] (for [x whatever i (f x)] i))
</code></pre>
<ul>
<li>#off-topic discussion about <strong>Clojure and teams productivity</strong> (Alex Miller) - I was astonished<br />
when I found <strong>there are only 4 people doing all the development on Clojure, Datomic</strong> et al.</li>
</ul>
<blockquote>
  <p>there are only 4 people doing all of the dev on Datomic, Clojure, etc combined so we are a tiny team of very experienced people using high leverage tools. I'm not sure this is directly relevant to most software teams in general (but Clojure projects do probably tend to be more that, and less big teams)</p>
  <p>Mythical man month is really from the perspective of someone working on teams of like 50-100 people, which is a totally different world</p>
  <p>no matter how big your team is, the important thing is to connect what people are doing with business value. as team size gets bigger, you inevitably are going to spend a lot more time communicating what to do and what has been done, which is inherently less efficient. So bigger teams need to put in more active effort to optimize that communication flow.</p>
  <p>Tools like Clojure and Datomic are designed to let a small team get higher leverage and do more with less, both in initial development AND over time as requirements and software changes (caring about this latter bit is imo something Rich pays way more attention to than most), which lets you stay small and avoid taking the efficiency hit in scaling longer than other tools.</p>
</blockquote>
<p>I was also surprised by a big performance difference betwee NumPy's array operations<br />
vs Clojure - see <a href="#python-for-data-science">Python for Data Science</a> for more details</p>
<div id="learning"></div>
<h2 id="learning">Learning</h2>
<div id="rapid-learner"></div>
<h3 id="rapid-learner">Rapid Learner</h3>
<p>I've been very curious about general learning strategies for a long time.<br />
A few years ago, I purchased the <a href="https://www.scotthyoung.com/courses/course/rapid-learner/">Rapid Learner course by Scott Young</a>.<br />
I've never managed to finish it although I adopted a few ideas from the course.<br />
A couple of weeks ago, I decided to restart the course (which now has a lot of new content marketed as "Rapid Learner 2.0").</p>
<p>The ideas of <strong>practice</strong> and <strong>directness</strong> are the core concepts in the course <br />
and it's focus is on practical projects. Thus I'm trying to apply the ideas while going through<br />
the <a href="#python-for-data-science">Python for Data Science</a> project.</p>
<div id="reading"></div>
<h2 id="reading">Reading</h2>
<p>I always liked reading - it was my passion since grammar school.<br />
Today I read mostly non-fiction books with heavy focus on programming-related topics.</p>
<p>I finished a wonderful practical book about networking called <br />
<a href="https://www.amazon.com/Networking-Systems-Administrators-Mastery-Book-ebook/dp/B00STLTH74">Networking for System Administrators</a>.<br />
I'll post more details on <a href="https://curiousprogrammer.net/book-summaries/">Book summaries</a> soon.</p>
<p>Recently, I've enjoyed reading <a href="https://basecamp.com/shapeup">Shape Up</a> by Ryan Singer from Basecamp<br />
and <a href="https://www.amazon.com/Writing-Well-Classic-Guide-Nonfiction/dp/0060891548">On Writing Well</a><br />
by William Zinsser.<br />
Both are great books and I'll tell you more about them soon.</p>
<p>Finally, you can check <a href="https://www.goodreads.com/user/show/61742630-juraj-martinka">my goodreads profile</a><br />
to find more books I've read or plan to read.</p>
<div id="writing"></div>
<h2 id="writing">Writing</h2>
<p>Writing is a great exercise for a programmer - it forces you to clear your thoughts<br />
and it's similar, in many aspects, to coding.</p>
<p>It's been my hope that I can learn and improve this skill ever since I started the <br />
<a href="https://curiousprogrammer.net/about/">curiousprogrammer.net blog</a>.<br />
I've been dormant for a while but now, armed with a few tips from <a href="#reading">On Writting Well</a>, <br />
I'm going to post new content more regularly.<br />
<a href="https://curiousprogrammer.net/weekly-bits-pieces/">Weekly Bits & Pieces</a> are the most recent<br />
addition.</p>
<div id="personal-hobbies"></div>
<h2 id="personal-hobbies">Personal (Hobbies)</h2>
<p>After a long break caused by COVID-19, we finally managed to do some rock climbing (not just bouldering)<br />
in Moravian Karst, Sloup (near Brno).<br />
It was fun despite a quite specific type of climbing (<em>very</em> polished) :).</p>
<div id="projects-update"></div>
<h2 id="projects-update">Projects Update</h2>
<div id="python-for-data-science"></div>
<h3 id="python-for-data-science">Python for Data Science</h3>
<p>I've decided to learn some Data Science using Python.<br />
I'm loosely following the curriculum outlined in <br />
<a href="https://www.kdnuggets.com/2019/06/python-data-science-right-way.html">How to Learn Python for Data Science the Right Way</a>.<br />
Python is a new language for me (excluding an old short-term experience), <br />
so the <a href="https://www.oreilly.com/library/view/python-for-data/9781491957653">Python for Data Analysis book</a><br />
seems to be a great fit.</p>
<p>Last week I finished Chapter 4 about <a href="https://numpy.org/"><strong>NumPy</strong></a>:</p>
<ul>
<li>It's a common low-level library for fast array computation - implemented in C and using<br />
"vectorized" functions operating on whole arrays instead of element-wise (like pure python)</li>
<li>I learned about <em>Slicing</em>, <em>Boolean indexing</em>, <em>Multi-dimensional arrays</em>, and <em>Random walks</em><br />
among other things. </li>
<li>I was amazed by the performance difference between Python (2-3 ms) and Clojure (13-14 ms)<br />
when multiplying an array of 1,000,000 elements by 2:</li>
</ul>
<pre><code>;;; Python =&gt; 22.8 ms for 10 iterations of 1,000,000 elements =&gt; 2-3 ms for a single iteration
import numpy as np

my_arr = np.arange(1000000)
my_list = list(range(1000000))

%time for _ in range(10): my_arr2 = my_arr * 2
CPU times: user 14.5 ms, sys: 8.33 ms, total: 22.8 ms
Wall time: 22.8 ms

;;; Clojure - vectors &amp; arrays =&gt; ~13 ms at best using plain arrays
(def my-array (int-array (range 1000000)))
(time
 (dotimes [i 10]
   (amap ^ints my-array
         idx
         ret
         (* (int 2) (aget ^ints my-array idx)))))
"Elapsed time: 133.522233 msecs"

;; use also criterium for more objective measurement
(require '[criterium.core :as crit])
(crit/quick-bench (amap ^ints my-array
                        idx
                        ret
                        (* (int 2) (aget ^ints my-array idx))))
;; Evaluation count : 48 in 6 samples of 8 calls.
;; Execution time mean : 14.022060 ms
;; Execution time std-deviation : 476.098590 Âµs
;; Execution time lower quantile : 13.728450 ms ( 2.5%)
;; Execution time upper quantile : 14.807910 ms (97.5%)
;; Overhead used : 8.025814 ns
</code></pre>
<ul>
<li><em>Random Walk</em> example in section 4.7 was pretty interesting - I don't think I ever heard<br />
about <em>first crossing time</em> value:</li>
<li><img src="2020-05-04-ds-random-walk-python.png" alt="Random Walk using plain python" /></li>
<li><img src="2020-05-04-ds-random-walk-numpy.png" alt="Random Walk using NumPy" /></li>
</ul>
<div id="sicp"></div>
<h3 id="sicp">SICP</h3>
<p>I've been reading <a href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book.html">Structure and Interpretation of Computer Programs</a> <br />
for a really long time.<br />
It's a fantastic and challenging book. <br />
It takes me a lot of time to do the exercises but they are definitly worth it.<br />
I'll keep crawling through the book at my toirtose pace :)</p>
<p>Last week I finished the <a href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-16.html#%_sec_2.3.4">Huffman Encoding</a><br />
section - apart from an exercise on how to represent trees<br />
I learned about <em>prefix codes</em> and <em>variable length encoding</em>.</p>
<p>You will find all my source code from the book here: <a href="https://github.com/jumarko/clojure-experiments/tree/master/src/clojure_experiments/books/sicp">https://github.com/jumarko/clojure-experiments/tree/master/src/clojure_experiments/books/sicp</a></p>
<div id="computer-systems"></div>
<h3 id="computer-systems">Computer Systems</h3>
<p><a href="https://www.amazon.com/Computer-Systems-Programmers-Perspective-Global-ebook/dp/B07V71PHR7/ref=pd_sbs_14_1/130-8492999-1421206?_encoding=UTF8&pd_rd_i=B07V71PHR7&pd_rd_r=ed8e11fb-e5ef-468e-8a46-b165f8f3d182&pd_rd_w=UG6HR&pd_rd_wg=oNLvC&pf_rd_p=d13bb895-21d3-4e96-94a7-553aaae51224&pf_rd_r=9WZHWXSX0QYER6ZFQXZ6&psc=1&refRID=9WZHWXSX0QYER6ZFQXZ6">Computer Systems: A Programmer's Perspective</a> <br />
is another great book - this time about lower-level programming, operating systems and machine/assembly language.</p>
<p>I started the chapter 3 <em>Machine-Level Representation of Programs</em> and found it refreshing<br />
after the chapter 2 about machine representation of numbers (which is math-heavy and became boring at some point)</p>
<p>I enjoyed a "disassembling" exercise with <code>gcc -Og</code> and <code>objdump -d</code> (section 3.2.2)</p>
<pre><code># diassemble object code
gcc -Og -c mstore.c
objdump -d mstore.o

# diassemble executable (object code + linking)
gcc -Og -o prog  main.c mstore.c
objdump -d prog
</code></pre>
<p>I've also found a striking connection to the Huffman Encoding section in SICP - x86 assembly<br />
is really a <em>prefix code</em>!</p>
<ul>
<li>Diassembled object code: <code>objdump -d mstore.o</code>  <br />
<img src="2020-05-04-cs-objdump-object-code.png" alt="Disassemble object code" /></li>
<li>Disassembled executable: <code>objdump -d prog</code>  <br />
<img src="2020-05-04-cs-objdump-executable.png" alt="Disassemble object code" /></li>
</ul>
<p>You can find my book code examples here: <a href="https://github.com/jumarko/computer-systems">https://github.com/jumarko/computer-systems</a></p>
<div id="work-codescene"></div>
<h2 id="work-codescene">Work (CodeScene)</h2>
<p>I joined company called Empear back in 2017 to work on <br />
<a href="https://empear.com/how-it-works/">CodeScene - a unique behavioral code analysis tool</a>.<br />
I've been really grateful for that - the team is great, I'm learning a lot every day<br />
and I can use Clojure in my daily work.</p>
<div id="codescene-40"></div>
<h3 id="codescene-40">CodeScene 4.0</h3>
<p>The last week was special because we released a new major version of our enterprise product:<br />
<a href="https://empear.com/blog/codescene-release-4_0/">CodeScene 4.0</a>.<br />
I haven't worked on this release - I'm mostly focusing on <a href="https://codescene.io">codescene.io</a> -<br />
but my colleagues did a great work in this area.<br />
The new version comes with a completely new more intuitive UI with greater focus on features auto-discovery.<br />
We're looking forward to hearing customers' feedback.</p>
<p>For <a href="https://codescene.io">codescene.io</a>, the "cloud" version of CodeScene, <br />
we're adding Bitbucket support (today you can only analyze GitHub repositories).<br />
It will be an important step for reaching a wider audience.</p>
<p>If you're interested, you can analyze your public repositories for free <br />
or <a href="https://codescene.io/plans">get a paid plan</a> if you want to try it on private projects.<br />
Moreover, if you're a student or a teacher you can get a paid plan for free:</p>
<ul>
<li><a href="https://codescene.io/github-students">https://codescene.io/github-students</a></li>
<li><a href="https://codescene.io/github-teachers">https://codescene.io/github-teachers</a></li>
</ul>
<div id="jvm-crash-and-slow-analyses"></div>
<h3 id="jvm-crash-and-slow-analyses">JVM crash and slow analyses</h3>
<p>While onboarding a few customers we faced issues with slow analyses.<br />
CodeScene is usually pretty fast (running Linux analysis in ~40 minutes on a Macbook Pro laptop with a solid SSD disk)<br />
but two customers were trying to analyze their big repositories and their analyses were running<br />
for more than one day.</p>
<p>There were three distinct cases:</p>
<ol>
<li>One customer running CodeScene in docker inside a Linux virtual machine hosted on Windows Server 2019</li>
<li>The same customer later switching to Tomcat deployment directly on the Windows Server host</li>
<li>Another customer using <a href="https://hub.docker.com/r/empear/ubuntu-onprem/">our docker image</a> <br />
and deploying CodeScene with Azure Containers</li>
</ol>
<div id="windows-server---linux-vm-and-jvm-bug"></div>
<h4 id="windows-server---linux-vm-and-jvm-bug">Windows Server - Linux VM and JVM bug</h4>
<p>First, they tried to run CodeScene using our docker image and hit a JVM bug right from the start:<br />
<img src="2020-05-04-codescene-avx-bug.png" alt="SIGILL JVM error" /></p>
<p>As my colleague found, this was due to incorrect detection of AVX instruction family support <br />
(vectorized processor instructions) in the JVM.<br />
There's an open issue for that: <a href="https://bugs.openjdk.java.net/browse/JDK-8238596">https://bugs.openjdk.java.net/browse/JDK-8238596</a>.</p>
<p>Once we identified the root cause the workaround was relatively easy - don't use AVX:</p>
<pre><code>docker run -e JAVA_OPTIONS=-XX:UseAVX=0 empear/ubuntu-onprem:latest
</code></pre>
<p>The AVX instruction support can be verified (on Linux) via <code>lscpu</code> - just check the <code>FLags</code> section<br />
if there's 'avx' or not:<br />
<img src="2020-05-04-codescene-avx-bug-lscpu.png" alt="lscpu - missing AVX flag" /></p>
<p>As we later found, the AVX instruction wasn't supported due to "Compatibility Configuration"<br />
on the Windows Server host which allowed the VMs to be easily migrated between physical hosts:<br />
<img src="2020-05-04-codescene-avx-bug-vm-compatibility.png" alt="Windows Server - VM compability configuration" /></p>
<p>The customer ended up using Tomcat installed directly on the Host Windows OS, <br />
but it was a really tricky support case anyway.</p>
<div id="windows-server---tomcat-and-small-heap-size"></div>
<h4 id="windows-server---tomcat-and-small-heap-size">Windows Server - Tomcat and small heap size</h4>
<p>The customer decided to switch from Docker to Tomcat deployment but the analysis was still very slow.<br />
We thought it could be a slow IO issue again, because of dealing with another customer's installation<br />
at the same time (see Azure Containers section below).<br />
But It turned out they were using really fast SAN (Storage Area Network) disk storage.</p>
<p>Eventually, we found the root cause: <strong>small <em>default</em> heap</strong> size set by Tomcat:<br />
although the machine had 32 GB of ram, the default Max heap size set by Tomcat Windows installer<br />
was only about ~250 MB.<br />
After raising the max heap size manually to 12 GB the analysis finished within a hour (they have a huge repository):<br />
<img src="2020-05-04-codescene-windows-tomcat-heap-settings.png" alt="Tomcat on Windows - heap settings" /></p>
<div id="azure-containers---really-slow-io"></div>
<h4 id="azure-containers---really-slow-io">Azure Containers - (really) slow IO</h4>
<p>Another painful experience with slow shared file storage on Azure.<br />
A customer analyzing a huge repository couldn't get the results even after a few days!<br />
The problem is still being investigated, but we believe the issue is shared file storage used<br />
by Azure Containers (and also Azure App Service).</p>
<p>CodeScene is an IO intensive application and needs a fast disk.<br />
Thus any kind of distributed file system makes it very sad.<br />
For these reasons <a href="https://docs.enterprise.codescene.io/versions/4.0.2/getting-started/deployment-options.html#system-requirements">we don't recommend using Azure Files, AWS EFS et al</a>.<br />
I ran CodeScene via Azure App Service the last year and found it <strong>at least 10x slower</strong> on medium-sized<br />
repositories compared to a deployment on a plain Linux VM.</p>

        </div>
        <style type='text/css'>body {
  font: 400 16px/1.5 "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #111;
  background-color: #fdfdfd;
  -webkit-text-size-adjust: 100%;
  -webkit-font-feature-settings: "kern" 1;
  -moz-font-feature-settings: "kern" 1;
  -o-font-feature-settings: "kern" 1;
  font-feature-settings: "kern" 1;
  font-kerning: normal;
  padding: 30px;
}

@media only screen and (max-width: 600px) {
  body {
    padding: 5px;
  }

  body > #content {
    padding: 0px 20px 20px 20px !important;
  }
}

body > #content {
  margin: 0px;
  max-width: 900px;
  border: 1px solid #e1e4e8;
  padding: 10px 40px;
  padding-bottom: 20px;
  border-radius: 2px;
  margin-left: auto;
  margin-right: auto;
}

hr {
  color: #bbb;
  background-color: #bbb;
  height: 1px;
  flex: 0 1 auto;
  margin: 1em 0;
  padding: 0;
  border: none;
}

/**
 * Links
 */
a {
  color: #0366d6;
  text-decoration: none; }
  a:visited {
    color: #0366d6; }
  a:hover {
    color: #0366d6;
    text-decoration: underline; }

pre {
  background-color: #f6f8fa;
  border-radius: 3px;
  font-size: 85%;
  line-height: 1.45;
  overflow: auto;
  padding: 16px;
}

/**
  * Code blocks
  */

code {
  background-color: rgba(27,31,35,.05);
  border-radius: 3px;
  font-size: 85%;
  margin: 0;
  word-wrap: break-word;
  padding: .2em .4em;
  font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;
}

pre > code {
  background-color: transparent;
  border: 0;
  display: inline;
  line-height: inherit;
  margin: 0;
  overflow: visible;
  padding: 0;
  word-wrap: normal;
  font-size: 100%;
}


/**
 * Blockquotes
 */
blockquote {
  margin-left: 30px;
  margin-top: 0px;
  margin-bottom: 16px;
  border-left-width: 3px;
  padding: 0 1em;
  color: #828282;
  border-left: 4px solid #e8e8e8;
  padding-left: 15px;
  font-size: 18px;
  letter-spacing: -1px;
  font-style: italic;
}
blockquote * {
  font-style: normal !important;
  letter-spacing: 0;
  color: #6a737d !important;
}

/**
 * Tables
 */
table {
  border-spacing: 2px;
  display: block;
  font-size: 14px;
  overflow: auto;
  width: 100%;
  margin-bottom: 16px;
  border-spacing: 0;
  border-collapse: collapse;
}

td {
  padding: 6px 13px;
  border: 1px solid #dfe2e5;
}

th {
  font-weight: 600;
  padding: 6px 13px;
  border: 1px solid #dfe2e5;
}

tr {
  background-color: #fff;
  border-top: 1px solid #c6cbd1;
}

table tr:nth-child(2n) {
  background-color: #f6f8fa;
}

/**
 * Others
 */

img {
  max-width: 100%;
}

p {
  line-height: 24px;
  font-weight: 400;
  font-size: 16px;
  color: #24292e; }

ul {
  margin-top: 0; }

li {
  color: #24292e;
  font-size: 16px;
  font-weight: 400;
  line-height: 1.5; }

li + li {
  margin-top: 0.25em; }

* {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  color: #24292e; }

a:visited {
  color: #0366d6; }

h1, h2, h3 {
  border-bottom: 1px solid #eaecef;
  color: #111;
  /* Darker */ }</style>
      </body>
    </html>
File '/Users/jumar/workspace/curious-programmer/blog/posts/weekly-bits-and-pieces/README.html' already exists. Aborted!
